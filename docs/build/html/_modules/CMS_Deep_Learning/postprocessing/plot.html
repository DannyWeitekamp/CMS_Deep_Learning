

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>CMS_Deep_Learning.postprocessing.plot &mdash; CMS_Deep_Learning 1.0.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../search.html"/>
    <link rel="top" title="CMS_Deep_Learning 1.0.0 documentation" href="../../../index.html"/>
        <link rel="up" title="Module code" href="../../index.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> CMS_Deep_Learning
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../postprocessing_example.html">Postprocessing Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../io_example.html">IO Example</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../io.html">CMS_Deep_Learning.io</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../preprocessing.html">CMS_Deep_Learning.preprocessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../layers.html">CMS_Deep_Learning.layers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../storage.html">CMS_Deep_Learning.storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../postprocessing.html">CMS_Deep_Learning.postprocessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../utils.html">CMS_Deep_Learning.utils</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">CMS_Deep_Learning</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>CMS_Deep_Learning.postprocessing.plot</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for CMS_Deep_Learning.postprocessing.plot</h1><div class="highlight"><pre>
<span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">metrics.py</span>
<span class="sd">Contains custom utilities for ploting and displaying training data.</span>
<span class="sd">Author: Danny Weitekamp</span>
<span class="sd">e-mail: dannyweitekamp@gmail.com</span>
<span class="sd">&#39;&#39;&#39;</span> 

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">.analysistools</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="k">import</span> <span class="n">Image</span><span class="p">,</span> <span class="n">display</span>
<span class="kn">from</span> <span class="nn">.metrics</span> <span class="k">import</span> <span class="n">get_roc_data</span>
<span class="kn">from</span> <span class="nn">.colors</span> <span class="k">import</span> <span class="n">resolveColors</span>

<div class="viewcode-block" id="plot_history"><a class="viewcode-back" href="../../../postprocessing.html#CMS_Deep_Learning.postprocessing.plot.plot_history">[docs]</a><span class="k">def</span> <span class="nf">plot_history</span><span class="p">(</span> <span class="n">histories</span><span class="p">,</span> <span class="n">plotLoss</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">plotAccuracy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">plotBest</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">acclims</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">useGrid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Plots an array of training histories against each other</span>
<span class="sd">        -input: [(String label, History hist, (optional) color), .... ]</span>
<span class="sd">        -Adopted from Jean-Roch Vlimant&#39;s Keras tutorial&quot;&quot;&quot;</span>

    <span class="kn">from</span> <span class="nn">keras.callbacks</span> <span class="k">import</span> <span class="n">History</span>

    <span class="n">colors</span><span class="o">=</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">histories</span><span class="p">))]</span>
    <span class="k">if</span><span class="p">(</span><span class="n">plotLoss</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Epoch&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;loss&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="n">title</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Training Error by Epoch&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">histories</span><span class="p">):</span>
            <span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
                <span class="n">label</span><span class="p">,</span><span class="n">history</span> <span class="o">=</span> <span class="n">h</span>
                <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">elif</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">):</span>
                <span class="n">label</span><span class="p">,</span><span class="n">history</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="n">h</span>
            <span class="k">if</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">History</span><span class="p">)):</span>
                <span class="n">history</span> <span class="o">=</span> <span class="n">history</span><span class="o">.</span><span class="n">history</span>
            <span class="n">l</span> <span class="o">=</span> <span class="n">label</span>
            <span class="n">vl</span><span class="o">=</span> <span class="n">label</span><span class="o">+</span><span class="s2">&quot; validation&quot;</span>
            <span class="k">if</span> <span class="s1">&#39;acc&#39;</span> <span class="ow">in</span> <span class="n">history</span><span class="p">:</span>
                <span class="n">l</span><span class="o">+=</span><span class="s1">&#39; (best acc </span><span class="si">%2.4f</span><span class="s1">)&#39;</span><span class="o">%</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;acc&#39;</span><span class="p">]))</span>
            <span class="k">if</span> <span class="s1">&#39;val_acc&#39;</span> <span class="ow">in</span> <span class="n">history</span><span class="p">:</span>
                <span class="n">vl</span><span class="o">+=</span><span class="s1">&#39; (best acc </span><span class="si">%2.4f</span><span class="s1">)&#39;</span><span class="o">%</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;val_acc&#39;</span><span class="p">]))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;loss&#39;</span><span class="p">],</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">l</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;val_loss&#39;</span> <span class="ow">in</span> <span class="n">history</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;val_loss&#39;</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;solid&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">vl</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
                
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">useGrid</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="n">show</span><span class="p">):</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">plt</span>
    
    <span class="k">if</span><span class="p">(</span><span class="n">plotAccuracy</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Epoch&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Accuracy&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="n">title</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Validation Accuracy by Epoch&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">histories</span><span class="p">):</span>
            <span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
                <span class="n">label</span><span class="p">,</span><span class="n">history</span> <span class="o">=</span> <span class="n">h</span>
                <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">elif</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">):</span>
                <span class="n">label</span><span class="p">,</span><span class="n">history</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="n">h</span>
            <span class="k">if</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">History</span><span class="p">)):</span>
                <span class="n">history</span> <span class="o">=</span> <span class="n">history</span><span class="o">.</span><span class="n">history</span>
            <span class="k">if</span> <span class="s1">&#39;acc&#39;</span> <span class="ow">in</span> <span class="n">history</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;acc&#39;</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="o">+</span><span class="s2">&quot; training accuracy&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
                <span class="k">if</span><span class="p">(</span><span class="n">plotBest</span><span class="p">):</span>
                    <span class="n">best</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;acc&#39;</span><span class="p">])</span>
                    <span class="n">loc</span> <span class="o">=</span> <span class="n">history</span><span class="p">[</span><span class="s1">&#39;acc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">best</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span> <span class="n">loc</span><span class="p">,</span> <span class="n">best</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">facecolors</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                                <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="o">+</span><span class="s2">&quot; best training accuracy = </span><span class="si">%0.4f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">best</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;val_acc&#39;</span> <span class="ow">in</span> <span class="n">history</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;val_acc&#39;</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;solid&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="o">+</span><span class="s2">&quot; validation accuracy&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
                <span class="k">if</span><span class="p">(</span><span class="n">plotBest</span><span class="p">):</span>
                    <span class="n">best</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;val_acc&#39;</span><span class="p">])</span>
                    <span class="n">loc</span> <span class="o">=</span> <span class="n">history</span><span class="p">[</span><span class="s1">&#39;val_acc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">best</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span> <span class="n">loc</span><span class="p">,</span> <span class="n">best</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">facecolors</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                                <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="o">+</span><span class="s2">&quot; best validation accuracy = </span><span class="si">%0.4f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">best</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="n">acclims</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">):</span>
             <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">acclims</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">useGrid</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">show</span><span class="p">):</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">plt</span></div>


<span class="k">def</span> <span class="nf">print_accuracy</span><span class="p">(</span> <span class="n">p</span><span class="p">,</span> <span class="n">test_target</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Prints the accuracy of a prediction array.</span>
<span class="sd">        -Taken from Jean-Roch Vlimant&#39;s Kreas tutorial&quot;&quot;&quot;</span>
    <span class="n">p_cat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="nb">print</span> <span class="s2">&quot;Fraction of good prediction&quot;</span>
    <span class="nb">print</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span> <span class="n">p_cat</span> <span class="o">==</span> <span class="n">test_target</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
    <span class="nb">print</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span> <span class="n">p_cat</span> <span class="o">==</span> <span class="n">test_target</span> <span class="p">)[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p_cat</span><span class="p">)),</span><span class="s2">&quot;%&quot;</span>
    
<span class="k">def</span> <span class="nf">print_accuracy_m</span><span class="p">(</span> <span class="n">model</span><span class="p">,</span> <span class="n">test_data</span><span class="p">,</span> <span class="n">test_target</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Prints the accuracy of a compiled model.&quot;&quot;&quot;</span>
    <span class="c1">##figure out the shape of the input expected</span>
    <span class="c1">#if hasattr(&#39;input_dim&#39;, model.layers[0]):</span>
    <span class="n">p</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_data</span><span class="p">)</span>
    <span class="n">print_accuracy</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">test_target</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">plotMetricVsMetric</span><span class="p">(</span><span class="n">trials</span><span class="p">,</span><span class="n">metricX</span><span class="p">,</span><span class="n">metricY</span><span class="o">=</span><span class="s2">&quot;val_acc&quot;</span><span class="p">,</span><span class="n">groupOn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">constants</span><span class="o">=</span><span class="p">{},</span> <span class="n">xlabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Trials&quot;</span><span class="p">,</span> <span class="n">legend_label</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shapes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">7</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;max&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">verbose_errors</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Plots one metric that can be found in the records of a set of KerasTrials vs another (i.e. val_acc vs depth). </span>
<span class="sd">        Asserts a one to one relationship incase of duplicate entries.</span>
<span class="sd">        </span>
<span class="sd">        :param trials: A list of trials to be used for the plot. This list will be culled down by specifying constants={&quot;record&quot; : value, ...}.</span>
<span class="sd">        :param metricX: The record entry to be used for the x-axis of the plot</span>
<span class="sd">        :param metricY: The record entry to be used for the y-axis of the plot</span>
<span class="sd">        :param groupOn: The record entry to group the data on to add a second explanitory variable</span>
<span class="sd">        :param constants: A dictionary of record values (i.e {&quot;depth&quot; : 2, ...}) that should be kept constant in the plot. For example </span>
<span class="sd">                    if you only wanted to plot trials with a dropout of 0.0 you would do constants = {&quot;dropout&quot; : 0.0}.</span>
<span class="sd">                    Ideally you want to keep record values that are not being compared constant, to maintain a one-to-one relationship.</span>
<span class="sd">                    To be certain of this one-to-one relationship set mode=&quot;error&quot;.</span>
<span class="sd">        :param xlabel: The X label of the plot</span>
<span class="sd">        :param ylabel: The Y label of the plot</span>
<span class="sd">        :param label: How to label objects in the legend if groupOn=None</span>
<span class="sd">        :param legend_label: The title for the lengend</span>
<span class="sd">        :param colors: A list of colors to use to represent each group, defaults to CMS_Deep_Learning.utils.colors.colors_contrasting</span>
<span class="sd">        :param shapes: list of marker shapes to use in the graph, defualts to [&#39;o&#39;,&#39;s&#39;,&#39;v&#39;, &#39;D&#39;, &#39;^&#39;,&#39;*&#39;, &#39;&lt;&#39;, &#39;&gt;&#39;]</span>
<span class="sd">        :param alpha: The alpha value (opacity) for each point in the plot</span>
<span class="sd">        :param mode: How to assert a one-to-one relationship between the trials in each group. Either &quot;max&quot; or &quot;min&quot; which simply take the trial</span>
<span class="sd">                with the maximum or minimum &#39;metricY&#39; value among conflicting trials. Alternately &quot;error&quot; throws an error if a one-to-one</span>
<span class="sd">                relationship cannot be resolved. The user can then edit the &#39;constants&#39; argument to satisfy this relationship. </span>
<span class="sd">                See CMS_Deep_Learning.analysistools.assertOneToOne for more information</span>
<span class="sd">        :param verbose: Whether or not to output extra information about the internals of the function for debugging.</span>
<span class="sd">        :param verbose_errors: Whether or not to print out longer summaries for conflicting trials if mode = &quot;error&quot;.</span>
<span class="sd">            &#39;&#39;&#39;</span>

    <span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">ax1</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
    <span class="k">if</span><span class="p">(</span><span class="n">colors</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">.colors</span> <span class="k">import</span> <span class="n">colors_contrasting1</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="n">colors_contrasting1</span>
    <span class="k">if</span><span class="p">(</span><span class="n">shapes</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">shapes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="s1">&#39;v&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;^&#39;</span><span class="p">,</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">]</span>
    <span class="n">trials_by_group</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span><span class="p">(</span><span class="n">groupOn</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">possibleValues</span> <span class="o">=</span> <span class="n">getMetricValues</span><span class="p">(</span><span class="n">trials</span><span class="p">,</span><span class="n">groupOn</span><span class="p">)</span>
        <span class="c1">#print(possibleValues)</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">possibleValues</span><span class="p">:</span>
            <span class="n">trials_by_group</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">findWithMetrics</span><span class="p">(</span><span class="n">trials</span><span class="p">,</span> <span class="p">{</span><span class="n">groupOn</span><span class="p">:</span><span class="n">v</span><span class="p">})</span>
    <span class="k">if</span><span class="p">(</span><span class="n">verbose</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;POINTS:&quot;</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">group</span><span class="p">,</span><span class="n">group_trials</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">trials_by_group</span><span class="o">.</span><span class="n">iteritems</span><span class="p">())</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">trials_by_group</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">[(</span><span class="n">label</span><span class="p">,</span><span class="n">trials</span><span class="p">)]):</span>
        <span class="n">group_trials</span> <span class="o">=</span> <span class="n">findWithMetrics</span><span class="p">(</span><span class="n">group_trials</span><span class="p">,</span> <span class="n">constants</span><span class="p">)</span>
        <span class="n">group_trials</span> <span class="o">=</span> <span class="n">assertOneToOne</span><span class="p">(</span><span class="n">group_trials</span><span class="p">,</span> <span class="n">metricX</span><span class="p">,</span><span class="n">metricY</span><span class="o">=</span><span class="n">metricY</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">verbose_errors</span><span class="o">=</span><span class="n">verbose_errors</span><span class="p">)</span>
        <span class="n">Xs</span> <span class="o">=</span> <span class="p">[</span> <span class="n">trial</span><span class="o">.</span><span class="n">get_from_record</span><span class="p">(</span><span class="n">metricX</span><span class="p">)</span> <span class="k">for</span> <span class="n">trial</span> <span class="ow">in</span> <span class="n">group_trials</span><span class="p">]</span>
        <span class="n">Ys</span> <span class="o">=</span> <span class="p">[</span><span class="n">trial</span><span class="o">.</span><span class="n">get_from_record</span><span class="p">(</span><span class="n">metricY</span><span class="p">)</span> <span class="k">for</span> <span class="n">trial</span> <span class="ow">in</span> <span class="n">group_trials</span><span class="p">]</span>
        <span class="c1">#Sort lists together</span>
        <span class="n">Xs</span><span class="p">,</span> <span class="n">Ys</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">Xs</span><span class="p">,</span> <span class="n">Ys</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]))]</span>
        <span class="k">if</span><span class="p">(</span><span class="n">verbose</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">group</span><span class="p">,</span><span class="nb">zip</span><span class="p">(</span><span class="n">Xs</span><span class="p">,</span> <span class="n">Ys</span><span class="p">)))</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)]</span> 
        <span class="n">j</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">shapes</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">shapes</span><span class="p">)]</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">rects1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">Xs</span><span class="p">,</span> <span class="n">Ys</span><span class="p">,</span>
                         <span class="c1">#color=&#39;b&#39;,</span>
                         <span class="c1">#color=tuple(np.random.random(3)),</span>
                         <span class="n">marker</span><span class="o">=</span><span class="n">s</span><span class="p">,</span>
                         <span class="n">alpha</span> <span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                         <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
                         <span class="n">edgecolors</span><span class="o">=</span><span class="n">b</span><span class="p">,</span>
                         <span class="n">color</span><span class="o">=</span><span class="n">c</span><span class="p">,</span>
                         <span class="n">label</span><span class="o">=</span><span class="n">group</span><span class="p">)</span>
        <span class="c1"># plt.xticks(Xs)</span>
    <span class="k">if</span><span class="p">(</span><span class="n">xlabel</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span> <span class="n">xlabel</span> <span class="o">=</span> <span class="n">metricX</span>
    <span class="k">if</span><span class="p">(</span><span class="n">ylabel</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span> <span class="n">ylabel</span> <span class="o">=</span> <span class="n">metricY</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> vs </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">metricY</span><span class="p">,</span> <span class="n">metricX</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">legend</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">legend_label</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
    <span class="c1">#plt.legend()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">legend</span><span class="o">.</span><span class="n">get_title</span><span class="p">(),</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="c1">#plt.tight_layout()</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">show</span><span class="p">):</span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">plt</span>

<span class="k">def</span> <span class="nf">plotEverything</span><span class="p">(</span><span class="n">trials</span><span class="p">,</span> <span class="n">custom_objects</span><span class="o">=</span><span class="p">{}):</span>
    <span class="sd">&#39;&#39;&#39;Plots all the information about a list of trials. For each trial: the model summary, a picture of the model and a plot of accuracy vs Epoch</span>

<span class="sd">    :param trials: A list of trials to plot</span>
<span class="sd">    :param custom_objects: in case your model includes layers that are not keras defaults, a dictionary of the layer classes keyed by their names</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1">#from keras.utils.visualize_util import plot</span>

    <span class="k">if</span><span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">trials</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span> <span class="n">trials</span> <span class="o">=</span> <span class="p">[</span><span class="n">trials</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">trials</span><span class="p">:</span>
        <span class="n">b</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">showTraining</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">showValidation</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">showFit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">showCompilation</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">get_from_record</span><span class="p">(</span><span class="s2">&quot;labels&quot;</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="n">labels</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">get_from_record</span><span class="p">(</span><span class="s2">&quot;lables&quot;</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">labels</span><span class="p">))</span> <span class="k">if</span><span class="p">(</span><span class="n">labels</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;Cannot Find Labels&quot;</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="n">custom_objects</span><span class="o">=</span><span class="n">custom_objects</span><span class="p">)</span>
        <span class="n">history</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">get_history</span><span class="p">()</span>
        <span class="n">plot_history</span><span class="p">([(</span><span class="n">name</span><span class="p">,</span> <span class="n">history</span><span class="p">)],</span> <span class="n">plotLoss</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
        <span class="c1">#dot = plot(model, to_file=&quot;model.png&quot;, show_shapes=True, show_layer_names=False)</span>
        <span class="c1">#image = Image(&quot;model.png&quot;)</span>
        <span class="c1">#display(image)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">keras.utils.visualize_util</span> <span class="k">import</span> <span class="n">plot</span>
            <span class="n">dot</span> <span class="o">=</span> <span class="n">plot</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">to_file</span><span class="o">=</span><span class="s2">&quot;model.png&quot;</span><span class="p">,</span> <span class="n">show_shapes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">show_layer_names</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">Image</span><span class="p">(</span><span class="s2">&quot;model.png&quot;</span><span class="p">)</span>
            <span class="n">display</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">plot_colors</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">show_edges</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Plots a list of colors with outlines taken from the same list</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

    <span class="c1"># Show the whole color range</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="p">(</span><span class="n">i</span> <span class="o">//</span> <span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">j</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="k">if</span> <span class="n">show_edges</span> <span class="k">else</span> <span class="n">c</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">7</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">b</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">plt</span>


<span class="k">def</span> <span class="nf">plot_table</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">cellText</span><span class="p">,</span> <span class="n">rowColors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">textSize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">nrows</span><span class="p">,</span> <span class="n">ncols</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span>
    <span class="n">hcell</span><span class="p">,</span> <span class="n">wcell</span> <span class="o">=</span> <span class="mf">0.005</span><span class="p">,</span> <span class="mf">1.</span>
    <span class="n">hpad</span><span class="p">,</span> <span class="n">wpad</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>    
    <span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">ncols</span><span class="o">*</span><span class="n">wcell</span><span class="o">+</span><span class="n">wpad</span><span class="p">,</span> <span class="n">nrows</span><span class="o">*</span><span class="n">hcell</span><span class="o">+</span><span class="n">hpad</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    

    <span class="n">table</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="n">cellText</span><span class="o">=</span><span class="n">cellText</span><span class="p">,</span>
                          <span class="n">rowLabels</span><span class="o">=</span><span class="n">rows</span><span class="p">,</span>
                          <span class="n">rowColours</span><span class="o">=</span><span class="n">rowColors</span><span class="p">,</span>
                          <span class="n">colLabels</span><span class="o">=</span><span class="n">columns</span><span class="p">,</span>
                          <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="n">textSize</span><span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">scale</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">show</span><span class="p">):</span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">plt</span>


<div class="viewcode-block" id="plot_roc_curve"><a class="viewcode-back" href="../../../postprocessing.html#CMS_Deep_Learning.postprocessing.plot.plot_roc_curve">[docs]</a><span class="k">def</span> <span class="nf">plot_roc_curve</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="p">[],</span> <span class="n">true_class_index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;ROC_Curve&quot;</span><span class="p">,</span> <span class="n">color_set</span><span class="o">=</span><span class="s2">&quot;colors_contrasting1&quot;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                   <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Computes the ROC curve parameterization of the validation set and plots it. (or not if show=False). Requires (trial), or (Y,predictions) or (model,data), or (model,X,Y)</span>
<span class="sd">    </span>
<span class="sd">        .. note:: Mutliple plots can be made by passing in a list of dictionaries containing the relevent kargs.</span>

<span class="sd">        :param args: An alternative input method for multiple ROC curves. List of dictionaries of arguments for </span>
<span class="sd">                    each curve.</span>
<span class="sd">        :param true_class_index: The index of the element of the predictions/labels that refers to the positive class</span>
<span class="sd">        :param title: The title of the plot</span>
<span class="sd">        :param color_set: A list of colors to use for each ROC.</span>
<span class="sd">        :param show: Whether or not to show the plot, can be useful if one only wants the parameterization data</span>
<span class="sd">        :param name: A name for use as a label in the plot</span>
<span class="sd">        :param *: Any argument available to :py:func:`CMS_Deep_Learning.postprocessing.metrics.get_roc_data` to get **ROC_data**,</span>
<span class="sd">                    and by extension any argument available to :py:func:`CMS_Deep_Learning.io.simple_grab` to get **Y**, **predictions**</span>

<span class="sd">        :returns: plt: the matplotlib handle, roc_dict:a list of dictionaries with ROC_data (tpr,fpr,thres,auc)</span>

<span class="sd">        &#39;&#39;&#39;</span>
    <span class="kn">from</span> <span class="nn">matplotlib</span> <span class="k">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
    <span class="n">inputs</span> <span class="o">=</span> <span class="n">args</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">inputs</span> <span class="o">=</span> <span class="p">[</span><span class="n">kargs</span><span class="p">]</span>

    <span class="n">colors</span> <span class="o">=</span> <span class="n">resolveColors</span><span class="p">(</span><span class="n">color_set</span><span class="p">)</span>

    <span class="n">roc_dicts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">inp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">inputs</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">inp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">inp</span><span class="p">[</span><span class="s2">&quot;true_class_index&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">true_class_index</span>
        <span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">thres</span><span class="p">,</span> <span class="n">roc_auc</span> <span class="o">=</span> <span class="n">get_roc_data</span><span class="p">(</span><span class="o">**</span><span class="n">inp</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">lw</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> \
                 <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%r</span><span class="s1"> (AUC): </span><span class="si">%0.4f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">roc_auc</span><span class="p">))</span>
        <span class="n">roc_dicts</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;ROC_data&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">thres</span><span class="p">,</span> <span class="n">roc_auc</span><span class="p">)})</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;navy&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;False Positive Rate&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;True Positive Rate&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;lower right&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">show</span><span class="p">):</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">plt</span><span class="p">,</span> <span class="n">roc_dicts</span></div>


<div class="viewcode-block" id="plot_dual_roc"><a class="viewcode-back" href="../../../postprocessing.html#CMS_Deep_Learning.postprocessing.plot.plot_dual_roc">[docs]</a><span class="k">def</span> <span class="nf">plot_dual_roc</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="p">[],</span> <span class="n">flipped</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">invertCont</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                  <span class="n">true_class_index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color_set</span><span class="o">=</span><span class="s2">&quot;colors_contrasting1&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Plots a roc curve or set of roc curves and its logscale counterpart</span>
<span class="sd">        </span>
<span class="sd">        :param args: An alternative input method for multiple ROC curves. List of dictionaries of arguments for </span>
<span class="sd">                    each curve.</span>
<span class="sd">        :param flipped: T/F flip the axis</span>
<span class="sd">        :param invertCont: T/F use the inverse of contamination</span>
<span class="sd">        :param title: The title of the plot</span>
<span class="sd">        :param color_set: A list of colors to use for each ROC.</span>
<span class="sd">        :param name: A name for use as a label in the plot</span>
<span class="sd">        :param *: Any argument available to :py:func:`CMS_Deep_Learning.postprocessing.metrics.get_roc_data` to get **ROC_data**,</span>
<span class="sd">                    and by extension any argument available to :py:func:`CMS_Deep_Learning.io.simple_grab` to get **Y**, **predictions**</span>
<span class="sd">        </span>
<span class="sd">        :returns: plt: the matplotlib handle, roc_dict:a list of dictionaries with ROC_data (tpr,fpr,thres,auc) </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span> <span class="nn">matplotlib</span> <span class="k">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
    <span class="kn">from</span> <span class="nn">matplotlib</span> <span class="k">import</span> <span class="n">rc</span>
    <span class="n">inputs</span> <span class="o">=</span> <span class="n">args</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">inputs</span> <span class="o">=</span> <span class="p">[</span><span class="n">kargs</span><span class="p">]</span>

    <span class="n">colors</span> <span class="o">=</span> <span class="n">resolveColors</span><span class="p">(</span><span class="n">color_set</span><span class="p">)</span>

    <span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span> <span class="s1">&#39;sans-serif&#39;</span><span class="p">,</span> <span class="s1">&#39;sans-serif&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Helvetica&#39;</span><span class="p">]})</span>
    <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

    <span class="n">roc_dicts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">inp</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">:</span>
        <span class="n">inp</span><span class="p">[</span><span class="s2">&quot;true_class_index&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">true_class_index</span>
        <span class="n">inp</span><span class="p">[</span><span class="s2">&quot;ROC_data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_roc_data</span><span class="p">(</span><span class="o">**</span><span class="n">inp</span><span class="p">)</span>
        <span class="n">roc_dicts</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">inp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="s2">&quot;ROC_data&quot;</span><span class="p">:</span> <span class="n">inp</span><span class="p">[</span><span class="s2">&quot;ROC_data&quot;</span><span class="p">]})</span>

    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="p">(</span><span class="n">use_log</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">],</span> <span class="p">[</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">])):</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">inp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;ROC_data&quot;</span><span class="p">][</span><span class="mi">3</span><span class="p">])):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">inp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">thres</span><span class="p">,</span> <span class="n">roc_auc</span> <span class="o">=</span> <span class="n">inp</span><span class="p">[</span><span class="s2">&quot;ROC_data&quot;</span><span class="p">]</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">invertCont</span><span class="p">):</span>
                <span class="n">fpr</span> <span class="o">=</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">x</span><span class="p">,</span> <span class="mf">40000.0</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">fpr</span><span class="p">]</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">flipped</span><span class="p">):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tpr</span><span class="p">,</span> <span class="n">fpr</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                        <span class="n">lw</span><span class="o">=.</span><span class="mi">7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (AUC): </span><span class="si">%0.4f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">roc_auc</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                        <span class="n">lw</span><span class="o">=.</span><span class="mi">7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (AUC): </span><span class="si">%0.4f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">roc_auc</span><span class="p">))</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">50</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">50</span><span class="p">),</span>
                <span class="n">color</span><span class="o">=</span><span class="s1">&#39;navy&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=.</span><span class="mi">4</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">flipped</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">use_log</span><span class="p">):</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">])</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">invertCont</span><span class="p">):</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;signal efficiency (TPR)&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">invertCont</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;1/(signal contamination) </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s2">&quot;log-scale&quot;</span> <span class="k">if</span> <span class="n">use_log</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;signal contamination </span><span class="si">%s</span><span class="s1"> (FPR)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s2">&quot;log-scale&quot;</span> <span class="k">if</span> <span class="n">use_log</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">use_log</span><span class="p">):</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">invertCont</span><span class="p">):</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">])</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;signal efficiency (TPR)&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">invertCont</span><span class="p">):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;1/(signal contamination) </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s2">&quot;log-scale&quot;</span> <span class="k">if</span> <span class="n">use_log</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;signal contamination </span><span class="si">%s</span><span class="s1"> (FPR)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s2">&quot;log-scale&quot;</span> <span class="k">if</span> <span class="n">use_log</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">plt</span><span class="p">,</span> <span class="n">roc_dicts</span></div>


<span class="k">def</span> <span class="nf">_expand_multi_vals</span><span class="p">(</span><span class="n">ys</span><span class="p">,</span> <span class="n">binlabel</span><span class="p">,</span> <span class="n">class_labels</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">out</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="p">(</span><span class="kc">True</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">ys</span><span class="p">]):</span>
        <span class="n">key_set</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="nb">set</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">ys</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)]))</span>
        <span class="n">ys</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="mf">0.0</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">key_set</span><span class="p">}</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">ys</span><span class="p">]</span>

        <span class="n">prefix</span> <span class="o">=</span> <span class="n">binlabel</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="k">if</span> <span class="n">binlabel</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="n">totals</span> <span class="o">=</span> <span class="p">[</span><span class="nb">sum</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">ys</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">key_set</span><span class="p">:</span>
            <span class="n">class_label</span> <span class="o">=</span> <span class="n">class_labels</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">if</span> <span class="n">class_labels</span> <span class="o">!=</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;class_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">ys</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">normalize</span><span class="p">):</span> <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">/</span> <span class="n">t</span> <span class="k">for</span> <span class="n">v</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">totals</span><span class="p">)]</span>
            <span class="n">out</span><span class="p">[</span><span class="n">prefix</span> <span class="o">+</span> <span class="n">class_label</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">out</span><span class="p">[</span><span class="n">binlabel</span><span class="p">]</span> <span class="o">=</span> <span class="n">ys</span>
    <span class="k">return</span> <span class="n">out</span>


<div class="viewcode-block" id="plot_bins"><a class="viewcode-back" href="../../../postprocessing.html#CMS_Deep_Learning.postprocessing.plot.plot_bins">[docs]</a><span class="k">def</span> <span class="nf">plot_bins</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span>
              <span class="n">y_val</span><span class="o">=</span><span class="s2">&quot;acc&quot;</span><span class="p">,</span>
              <span class="n">min_samples</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
              <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span>
              <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
              <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
              <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
              <span class="n">class_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">legendTitle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">legendBelow</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">alpha</span><span class="o">=.</span><span class="mi">8</span><span class="p">,</span>
              <span class="n">colors</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">],</span>
              <span class="n">shapes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.025</span><span class="p">),</span>
              <span class="n">useGrid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
              <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">stack</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">normalize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Plots the output of CMS_Deep_Learning.utils.metrics.accVsEventChar</span>

<span class="sd">        :param bins: A list of dictionaries outputted by CMS_Deep_Learning.postprocessing.metrics.bin_metric_vs_char</span>
<span class="sd">                    or a dictionary of such lists keyed by a label for each binset.</span>
<span class="sd">        :param min_samples: The minumum number of samples that must be in a bin for it to be plotted.</span>
<span class="sd">        :param y_val: The y_value to plot </span>
<span class="sd">        :param mode: &quot;bar&quot;,&quot;scatter&quot; or &#39;histo&#39;</span>
<span class="sd">        :param title: The title of the plot</span>
<span class="sd">        :param xlabel: The xlabel of the plot</span>
<span class="sd">        :param ylabel: the ylabel of the plot</span>
<span class="sd">        :param class_labels: A list of labels to be shown in the legend. One for each set of bins.</span>
<span class="sd">        :param legendTitle: The title of the legend.</span>
<span class="sd">        :param legendBelow: Whether or not to put the legend below the graph</span>
<span class="sd">        :param alpha: The opacity of the plot.</span>
<span class="sd">        :param colors: the colors for each set of bins (see how matplotlib handles colors)</span>
<span class="sd">        :param shapes: the shapes of the markers for the graph</span>
<span class="sd">        :param xlim: a tuple (minX, maxX) that determines he x range of the view of the graph</span>
<span class="sd">        :param ylim: a tuple (minY, maxY) that determines he y range of the view of the graph </span>
<span class="sd">        :param useGrid: if True then display a grid in the background of the graph</span>
<span class="sd">        :param args: An alternative input method for multiple ROC curves. List of dictionaries of arguments for </span>
<span class="sd">                    each curve.</span>
<span class="sd">        :param true_class_index: The index of the element of the predictions/labels that refers to the positive class</span>
<span class="sd">        :param title: The title of the plot</span>
<span class="sd">        :param color_set: A list of colors to use for each ROC.</span>
<span class="sd">        :param show: Whether or not to show the plot, can be useful if one only wants the parameterization data</span>


<span class="sd">        :returns: plt: the matplotlib handle, roc_dict:a list of dictionaries with ROC_data (tpr,fpr,thres,auc)</span>
<span class="sd">        &#39;&#39;&#39;</span>
    <span class="kn">from</span> <span class="nn">matplotlib</span> <span class="k">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)):</span>
        <span class="n">bins</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;&quot;</span><span class="p">:</span> <span class="n">bins</span><span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">shapes</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">shapes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="s1">&#39;v&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;^&#39;</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">colors</span><span class="p">]</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">useGrid</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;bar&quot;</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_axisbelow</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">binlabel</span><span class="p">,</span> <span class="n">bs</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bins</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)]</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">binlabel</span>  <span class="c1"># binLabels[i] if binLabels != None and len(binLabels) &gt; i else None</span>
        <span class="n">xs</span> <span class="o">=</span> <span class="p">[</span><span class="n">b</span><span class="p">[</span><span class="s2">&quot;min_bin_x&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bs</span> <span class="k">if</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="s2">&quot;num_samples&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">min_samples</span><span class="p">)]</span>
        <span class="n">bot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">xs</span><span class="p">))</span>
        <span class="n">widths</span> <span class="o">=</span> <span class="p">[</span><span class="n">b</span><span class="p">[</span><span class="s2">&quot;max_bin_x&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">b</span><span class="p">[</span><span class="s2">&quot;min_bin_x&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bs</span> <span class="k">if</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="s2">&quot;num_samples&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">min_samples</span><span class="p">)]</span>

        <span class="n">ys</span> <span class="o">=</span> <span class="p">[</span><span class="n">b</span><span class="p">[</span><span class="n">y_val</span><span class="p">]</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bs</span> <span class="k">if</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="s2">&quot;num_samples&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">min_samples</span><span class="p">)]</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">y_val</span> <span class="o">+</span> <span class="s2">&quot;_error&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">bs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> \
            <span class="k">else</span> <span class="p">[</span><span class="n">b</span><span class="p">[</span><span class="n">y_val</span> <span class="o">+</span> <span class="s2">&quot;_error&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bs</span> <span class="k">if</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="s2">&quot;num_samples&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">min_samples</span><span class="p">)]</span>

        <span class="n">ys</span> <span class="o">=</span> <span class="n">_expand_multi_vals</span><span class="p">(</span><span class="n">ys</span><span class="p">,</span> <span class="n">binlabel</span><span class="p">,</span> <span class="n">class_labels</span><span class="p">,</span> <span class="n">normalize</span><span class="p">)</span>
        <span class="c1"># errors = _expand_multi_vals(errors,binlabel,class_labels)</span>
        <span class="n">items</span> <span class="o">=</span> <span class="n">ys</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;bar&#39;</span> <span class="ow">or</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;histo&#39;</span><span class="p">):</span> <span class="n">items</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">items</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;bar&quot;</span><span class="p">):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">widths</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">errors</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">j</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)],</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">ecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
                       <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="n">log</span><span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;histo&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">stack</span><span class="p">):</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">widths</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">errors</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="n">bot</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">j</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)],</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
                           <span class="n">ecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="n">log</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Append points to beginning and end</span>
                    <span class="n">_xs</span> <span class="o">=</span> <span class="p">[</span><span class="n">b</span><span class="p">[</span><span class="s2">&quot;max_bin_x&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bs</span> <span class="k">if</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="s2">&quot;num_samples&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">min_samples</span><span class="p">)]</span>
                    <span class="n">_xs</span> <span class="o">=</span> <span class="p">[</span><span class="n">bs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;min_bin_x&#39;</span><span class="p">]]</span> <span class="o">+</span> <span class="n">_xs</span> <span class="o">+</span> <span class="p">[</span><span class="n">_xs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
                    <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">_xs</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;steps&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">j</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)],</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">stack</span><span class="p">):</span> <span class="n">bot</span> <span class="o">+=</span> <span class="n">y</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">shapes</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)]</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">j</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)],</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">s</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">errors</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">j</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)],</span> <span class="n">ecolor</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">j</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)],</span>
                            <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                            <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">log</span><span class="p">):</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">legendBelow</span><span class="p">):</span>
        <span class="n">legend</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">legendTitle</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper center&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.15</span><span class="p">),</span>
                           <span class="n">fancybox</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">legend</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">legendTitle</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">legendTitle</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">):</span> <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">legend</span><span class="o">.</span><span class="n">get_title</span><span class="p">(),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">show</span><span class="p">):</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">plt</span></div>
</pre></div>

           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Daniel Phillip Weitekamp.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'1.0.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>